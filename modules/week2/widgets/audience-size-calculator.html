<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audience Size Calculator - Media Rights Valuation</title>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --color-neutral-50: #fafafa;
            --color-neutral-100: #f5f5f5;
            --color-neutral-200: #e5e5e5;
            --color-neutral-300: #d4d4d4;
            --color-neutral-400: #a3a3a3;
            --color-neutral-500: #737373;
            --color-neutral-600: #525252;
            --color-neutral-700: #404040;
            --color-neutral-800: #262626;
            --color-neutral-900: #171717;
            --color-accent: #6b9085;
            --color-accent-light: #c0d1cd;
            --border-radius: 8px;
            --border-radius-sm: 4px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        *:focus { outline: 2px solid #3182ce; outline-offset: 2px; }
        body { font-family: 'Geist', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: white; color: var(--color-neutral-800); padding: 1.5rem; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; }
        .widget-box { background: var(--color-neutral-50); border: 2px solid var(--color-neutral-200); border-radius: var(--border-radius); padding: 1.5rem; }
        .widget-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.75rem; }
        .widget-title { font-size: 1.25rem; font-weight: 700; color: var(--color-neutral-900); }
        .widget-subtitle { font-size: 0.85rem; color: var(--color-neutral-600); margin-bottom: 1rem; }

        /* Presets row */
        .presets-row { display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1rem; }
        .preset-btn { background: var(--color-neutral-800); color: white; border: none; border-radius: var(--border-radius-sm); padding: 0.375rem 0.75rem; font-size: 0.75rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: background 0.2s; }
        .preset-btn:hover { background: var(--color-neutral-700); }
        .preset-btn.active { background: var(--color-accent); }

        /* Two-column layout */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1rem; }

        /* Input panel */
        .input-panel { background: white; border: 1px solid var(--color-neutral-200); border-radius: var(--border-radius-sm); padding: 1rem; }
        .panel-label { font-size: 0.75rem; font-weight: 600; color: var(--color-neutral-500); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.75rem; }

        .form-row { margin-bottom: 0.875rem; }
        .form-row:last-child { margin-bottom: 0; }
        .form-label { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; font-weight: 500; color: var(--color-neutral-700); margin-bottom: 0.25rem; }
        .form-value { font-weight: 600; color: var(--color-neutral-900); min-width: 60px; text-align: right; }
        input[type="range"] { width: 100%; height: 6px; border-radius: 3px; background: var(--color-neutral-300); -webkit-appearance: none; appearance: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--color-neutral-800); cursor: pointer; }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: var(--color-neutral-800); cursor: pointer; border: none; }

        /* Results panel */
        .results-panel { background: white; border: 1px solid var(--color-neutral-200); border-left: 3px solid var(--color-accent); border-radius: var(--border-radius-sm); padding: 1rem; }
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--color-neutral-100); }
        .result-row:last-child { border-bottom: none; }
        .result-label { font-size: 0.85rem; color: var(--color-neutral-600); }
        .result-value { font-size: 0.95rem; font-weight: 600; color: var(--color-neutral-800); }
        .result-value.highlight { font-size: 1.1rem; color: var(--color-accent); }

        /* Chart section */
        .chart-section { background: white; border: 1px solid var(--color-neutral-200); border-radius: var(--border-radius-sm); padding: 1rem; margin-bottom: 1rem; }
        .chart-container { height: 200px; }

        /* Action row */
        .action-row { display: flex; justify-content: flex-end; gap: 0.5rem; }
        .btn { padding: 0.5rem 1rem; border: none; border-radius: var(--border-radius-sm); font-size: 0.8rem; font-weight: 600; cursor: pointer; font-family: inherit; transition: background 0.2s; }
        .btn-secondary { background: var(--color-neutral-200); color: var(--color-neutral-700); }
        .btn-secondary:hover { background: var(--color-neutral-300); }
        .btn-primary { background: var(--color-neutral-800); color: white; }
        .btn-primary:hover { background: var(--color-neutral-700); }

        /* Responsive */
        @media (max-width: 640px) {
            body { padding: 1rem; }
            .widget-box { padding: 1rem; }
            .two-col { grid-template-columns: 1fr; }
            .chart-container { height: 180px; }
        }

        @media (prefers-reduced-motion: reduce) {
            * { transition: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="widget-box">
            <div class="widget-header">
                <h1 class="widget-title">Audience Size Calculator</h1>
            </div>
            <p class="widget-subtitle">Calculate media rights value: Audience x Demographics x CPM = Rights Value</p>

            <div class="presets-row" role="group" aria-label="League presets">
                <button class="preset-btn active" data-preset="nfl">NFL</button>
                <button class="preset-btn" data-preset="nhl">NHL</button>
                <button class="preset-btn" data-preset="nba">NBA</button>
                <button class="preset-btn" data-preset="mls">MLS</button>
                <button class="preset-btn" data-preset="epl">Premier League</button>
            </div>

            <div class="two-col">
                <div class="input-panel">
                    <div class="panel-label">Inputs</div>

                    <div class="form-row">
                        <div class="form-label">
                            <span>Avg Viewers/Game (M)</span>
                            <span class="form-value" id="viewers-value">17.0M</span>
                        </div>
                        <input type="range" id="avg-viewers" min="0.1" max="25" step="0.1" value="17.0" aria-label="Average viewers per game in millions">
                    </div>

                    <div class="form-row">
                        <div class="form-label">
                            <span>Games per Season</span>
                            <span class="form-value" id="games-value">272</span>
                        </div>
                        <input type="range" id="num-games" min="50" max="2000" step="10" value="272" aria-label="Number of games per season">
                    </div>

                    <div class="form-row">
                        <div class="form-label">
                            <span>Premium Demo % (18-49)</span>
                            <span class="form-value" id="demo-value">45%</span>
                        </div>
                        <input type="range" id="demo-percent" min="10" max="70" step="1" value="45" aria-label="Percentage in premium demographic">
                    </div>

                    <div class="form-row">
                        <div class="form-label">
                            <span>CPM ($)</span>
                            <span class="form-value" id="cpm-value">$65</span>
                        </div>
                        <input type="range" id="cpm" min="20" max="100" step="5" value="65" aria-label="Cost per thousand viewers">
                    </div>
                </div>

                <div class="results-panel" role="region" aria-label="Calculated results" aria-live="polite">
                    <div class="panel-label">Results</div>

                    <div class="result-row">
                        <span class="result-label">Total Reach</span>
                        <span class="result-value" id="total-reach">4.6B impressions</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Demo Multiplier</span>
                        <span class="result-value" id="demo-multiplier">1.45x</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Ad Revenue Potential</span>
                        <span class="result-value" id="ad-revenue">$300M</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Annual Rights Value</span>
                        <span class="result-value highlight" id="rights-value">$174M</span>
                    </div>
                    <div class="result-row">
                        <span class="result-label">Per-Game Value</span>
                        <span class="result-value" id="per-game">$640K</span>
                    </div>
                </div>
            </div>

            <div class="chart-section">
                <div class="chart-container">
                    <canvas id="comparisonChart" role="img" aria-label="Bar chart comparing league rights values"></canvas>
                </div>
            </div>

            <div class="action-row">
                <button class="btn btn-secondary" id="reset-btn">Reset</button>
                <button class="btn btn-primary" id="export-btn">Export CSV</button>
            </div>
        </div>
    </div>

    <script>
        const presets = {
            nfl: { avgViewers: 17.0, numGames: 272, demoPercent: 45, cpm: 65 },
            nhl: { avgViewers: 1.5, numGames: 1271, demoPercent: 40, cpm: 55 },
            nba: { avgViewers: 1.6, numGames: 1312, demoPercent: 48, cpm: 60 },
            mls: { avgViewers: 0.3, numGames: 408, demoPercent: 35, cpm: 45 },
            epl: { avgViewers: 0.9, numGames: 380, demoPercent: 42, cpm: 50 }
        };

        const avgViewersInput = document.getElementById('avg-viewers');
        const numGamesInput = document.getElementById('num-games');
        const demoPercentInput = document.getElementById('demo-percent');
        const cpmInput = document.getElementById('cpm');
        const presetBtns = document.querySelectorAll('.preset-btn');
        let chart = null;
        let currentPreset = 'nfl';

        function loadPreset(key) {
            const p = presets[key];
            avgViewersInput.value = p.avgViewers;
            numGamesInput.value = p.numGames;
            demoPercentInput.value = p.demoPercent;
            cpmInput.value = p.cpm;
            currentPreset = key;
            presetBtns.forEach(btn => btn.classList.toggle('active', btn.dataset.preset === key));
            calculate();
        }

        function calculate() {
            const avgViewers = parseFloat(avgViewersInput.value);
            const numGames = parseInt(numGamesInput.value);
            const demoPercent = parseFloat(demoPercentInput.value);
            const cpm = parseFloat(cpmInput.value);

            // Update displays
            document.getElementById('viewers-value').textContent = avgViewers.toFixed(1) + 'M';
            document.getElementById('games-value').textContent = numGames;
            document.getElementById('demo-value').textContent = demoPercent + '%';
            document.getElementById('cpm-value').textContent = '$' + cpm;

            // Calculate
            const totalReach = avgViewers * numGames;
            const demoMultiplier = 1 + (demoPercent / 100);
            const adRevenue = (totalReach * cpm) / 1000;
            const rightsValue = adRevenue * demoMultiplier * 0.4;
            const perGame = rightsValue / numGames;

            // Update results
            document.getElementById('total-reach').textContent = formatLarge(totalReach) + ' impressions';
            document.getElementById('demo-multiplier').textContent = demoMultiplier.toFixed(2) + 'x';
            document.getElementById('ad-revenue').textContent = formatCurrency(adRevenue);
            document.getElementById('rights-value').textContent = formatCurrency(rightsValue);
            document.getElementById('per-game').textContent = formatCurrency(perGame);

            updateChart(rightsValue);
        }

        function formatLarge(num) {
            if (num >= 1000) return (num / 1000).toFixed(1) + 'B';
            return num.toFixed(1) + 'M';
        }

        function formatCurrency(val) {
            if (val >= 1000) return '$' + (val / 1000).toFixed(2) + 'B';
            return '$' + val.toFixed(0) + 'M';
        }

        function updateChart(currentValue) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            if (chart) chart.destroy();

            const labels = ['NFL', 'Your Selection'];
            const values = [10000, currentValue]; // NFL baseline $10B

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Rights Value ($M)',
                        data: values,
                        backgroundColor: ['rgba(107, 144, 133, 0.6)', 'rgba(38, 38, 38, 0.7)'],
                        borderColor: ['#6b9085', '#262626'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: v => v >= 1000 ? '$' + (v/1000).toFixed(0) + 'B' : '$' + v + 'M' }
                        }
                    }
                }
            });
        }

        function exportData() {
            const rows = [
                'Metric,Value',
                `League,${currentPreset.toUpperCase()}`,
                `Avg Viewers,${avgViewersInput.value}M`,
                `Games,${numGamesInput.value}`,
                `Demo %,${demoPercentInput.value}%`,
                `CPM,$${cpmInput.value}`,
                `Rights Value,${document.getElementById('rights-value').textContent}`
            ];
            const blob = new Blob([rows.join('\n')], { type: 'text/csv' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `audience-calculator-${Date.now()}.csv`;
            a.click();
        }

        presetBtns.forEach(btn => btn.addEventListener('click', () => loadPreset(btn.dataset.preset)));
        [avgViewersInput, numGamesInput, demoPercentInput, cpmInput].forEach(el => el.addEventListener('input', calculate));
        document.getElementById('reset-btn').addEventListener('click', () => loadPreset('nfl'));
        document.getElementById('export-btn').addEventListener('click', exportData);

        loadPreset('nfl');
    </script>
</body>
</html>
