<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Trends Predictor - Strategic Planning Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Geist', -apple-system, sans-serif;
            background: white;
            color: #171717;
            padding: 24px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #171717;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #525252;
            margin-bottom: 24px;
            font-size: 0.95rem;
        }

        .step {
            background: #fafafa;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: #171717;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 12px;
        }

        .step-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #171717;
        }

        .trends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .trend-card {
            background: white;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .trend-card:hover {
            border-color: #171717;
        }

        .trend-card.selected {
            border-color: #171717;
            background: #fafafa;
            border-width: 2px;
        }

        .trend-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .trend-card.disabled:hover {
            border-color: #d4d4d4;
        }

        .trend-name {
            font-weight: 600;
            color: #171717;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .trend-desc {
            font-size: 0.85rem;
            color: #525252;
            line-height: 1.4;
        }

        .selected-count {
            background: #171717;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            display: inline-block;
            margin-top: 15px;
        }

        .budget-section {
            margin-top: 20px;
        }

        .budget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }

        .budget-total {
            font-size: 1.4rem;
            font-weight: 700;
            color: #171717;
        }

        .budget-remaining {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .budget-remaining.positive {
            color: #525252;
        }

        .budget-remaining.zero {
            color: #525252;
        }

        .budget-remaining.negative {
            color: #dc2626;
        }

        .allocation-slider {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .trend-label {
            font-weight: 600;
            color: #171717;
            font-size: 0.95rem;
        }

        .slider-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #171717;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e5e5e5;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #171717;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #171717;
            cursor: pointer;
            border: none;
        }

        input[type="range"]:focus {
            outline: 2px solid #3182ce;
            outline-offset: 2px;
        }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .scenario-tab {
            flex: 1;
            padding: 10px 24px;
            background: white;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: background 0.2s;
        }

        .scenario-tab:hover {
            background: #fafafa;
        }

        .scenario-tab:focus {
            outline: 2px solid #3182ce;
            outline-offset: 2px;
        }

        .scenario-tab.active {
            background: #171717;
            color: white;
            border-color: #171717;
        }

        .chart-container {
            background: white;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            height: 400px;
        }

        .expert-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .expert-card {
            background: white;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            padding: 20px;
        }

        .expert-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #171717;
            margin-bottom: 10px;
        }

        .expert-trend {
            padding: 8px 0;
            border-bottom: 1px solid #e5e5e5;
            color: #525252;
        }

        .expert-trend:last-child {
            border-bottom: none;
        }

        .matrix-container {
            background: white;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: 100px 1fr 1fr;
            grid-template-rows: 100px 1fr 1fr;
            gap: 2px;
            background: #e5e5e5;
            margin-top: 15px;
        }

        .matrix-cell {
            background: white;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }

        .matrix-label {
            font-weight: 600;
            color: #171717;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .matrix-quadrant {
            background: #fafafa;
        }

        .matrix-trend-item {
            background: #171717;
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            margin: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 10px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
            font-family: inherit;
            transition: background 0.2s;
        }

        .btn-primary {
            background: #171717;
            color: white;
        }

        .btn-primary:hover {
            background: #404040;
        }

        .btn-secondary {
            background: white;
            color: #171717;
            border: 1px solid #171717;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        .btn:focus {
            outline: 2px solid #3182ce;
            outline-offset: 2px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            body { padding: 16px; }
            h1 { font-size: 1.5rem; }
            .trends-grid {
                grid-template-columns: 1fr;
            }
            .expert-comparison {
                grid-template-columns: 1fr;
            }
            .matrix-grid {
                grid-template-columns: 80px 1fr;
                grid-template-rows: 80px 1fr 1fr;
            }
            .action-buttons {
                flex-direction: column;
            }
        }

        .section {
            margin-bottom: 1.5rem;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
            background: white;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            cursor: pointer;
            user-select: none;
            background: #fafafa;
            border-radius: 8px 8px 0 0;
            transition: background 0.2s;
        }

        .section-header:hover {
            background: #f5f5f5;
        }

        .section-header h2 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #171717;
            margin: 0;
        }

        .toggle-icon {
            font-size: 1.2rem;
            color: #525252;
            transition: transform 0.2s ease;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-content.expanded {
            max-height: 4000px;
        }

        .section-inner {
            padding: 1.5rem;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        .hidden {
            display: none;
        }

        .impact-summary {
            background: white;
            border: 1px solid #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .impact-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e5e5e5;
        }

        .impact-row:last-child {
            border-bottom: none;
        }

        .impact-label {
            font-weight: 500;
            color: #525252;
        }

        .impact-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .impact-positive {
            color: #059669;
        }

        .impact-neutral {
            color: #525252;
        }

        .impact-negative {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Future Trends Predictor</h1>
        <p class="subtitle">Select 3 trends, allocate $50M budget, and analyze strategic impact on your revenue streams</p>

        <!-- Step 1: Trend Selection -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('step1')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('step1');}" tabindex="0" role="button" aria-expanded="true" aria-controls="step1-content">
                <h2>Step 1: Select Your Top 3 Trends</h2>
                <span class="toggle-icon expanded" aria-hidden="true">▼</span>
            </div>
            <div class="section-content expanded" id="step1-content">
                <div class="section-inner">
            <p style="color: #6b7280; margin-bottom: 15px;">Choose the three trends most critical to your organization's future</p>

            <div class="trends-grid" id="trendsGrid"></div>
            <div class="selected-count" id="selectedCount">Selected: 0 / 3</div>
                </div>
            </div>
        </div>

        <!-- Step 2: Budget Allocation -->
        <div class="section hidden" id="step2">
            <div class="section-header" onclick="toggleSection('step2-budget')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('step2-budget');}" tabindex="0" role="button" aria-expanded="true" aria-controls="step2-budget-content">
                <h2>Step 2: Allocate $50M Budget</h2>
                <span class="toggle-icon expanded" aria-hidden="true">▼</span>
            </div>
            <div class="section-content expanded" id="step2-budget-content">
                <div class="section-inner">

            <div class="budget-header">
                <div class="budget-total">Total Budget: $50M</div>
                <div class="budget-remaining positive" id="budgetRemaining">Remaining: $50M</div>
            </div>

            <div id="budgetSliders"></div>
                </div>
            </div>
        </div>

        <!-- Step 3: Impact Analysis -->
        <div class="section hidden" id="step3">
            <div class="section-header" onclick="toggleSection('step3-impact')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('step3-impact');}" tabindex="0" role="button" aria-expanded="false" aria-controls="step3-impact-content">
                <h2>Step 3: Revenue Stream Impact Analysis</h2>
                <span class="toggle-icon" aria-hidden="true">▼</span>
            </div>
            <div class="section-content" id="step3-impact-content">
                <div class="section-inner">

            <div class="scenario-tabs">
                <div class="scenario-tab active" data-scenario="optimistic" onclick="switchScenario('optimistic')">
                    📈 Optimistic
                </div>
                <div class="scenario-tab" data-scenario="realistic" onclick="switchScenario('realistic')">
                    📊 Realistic
                </div>
                <div class="scenario-tab" data-scenario="pessimistic" onclick="switchScenario('pessimistic')">
                    📉 Pessimistic
                </div>
            </div>

            <div class="chart-container">
                <canvas id="impactChart"></canvas>
            </div>

            <div class="impact-summary" id="impactSummary"></div>
                </div>
            </div>
        </div>

        <!-- Step 4: Expert Comparison -->
        <div class="section hidden" id="step4">
            <div class="section-header" onclick="toggleSection('step4-expert')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('step4-expert');}" tabindex="0" role="button" aria-expanded="false" aria-controls="step4-expert-content">
                <h2>Step 4: Expert Forecast Comparison</h2>
                <span class="toggle-icon" aria-hidden="true">▼</span>
            </div>
            <div class="section-content" id="step4-expert-content">
                <div class="section-inner">

            <div class="expert-comparison">
                <div class="expert-card">
                    <div class="expert-name">McKinsey & Company</div>
                    <div class="expert-trend"><strong>Top Priority:</strong> AI & Personalization (35%)</div>
                    <div class="expert-trend"><strong>Emerging:</strong> Women's Sports Growth (25%)</div>
                    <div class="expert-trend"><strong>Watch:</strong> Direct-to-Fan Models (20%)</div>
                    <div class="expert-trend"><strong>Risk:</strong> Traditional Broadcasting Decline</div>
                </div>
                <div class="expert-card">
                    <div class="expert-name">Deloitte Sports</div>
                    <div class="expert-trend"><strong>Top Priority:</strong> Streaming & Digital (30%)</div>
                    <div class="expert-trend"><strong>Emerging:</strong> Betting Integration (28%)</div>
                    <div class="expert-trend"><strong>Watch:</strong> Gen Z Engagement (22%)</div>
                    <div class="expert-trend"><strong>Risk:</strong> Regulatory Changes in Gambling</div>
                </div>
            </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Strategic Positioning -->
        <div class="section hidden" id="step5">
            <div class="section-header" onclick="toggleSection('step5-matrix')" onkeydown="if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleSection('step5-matrix');}" tabindex="0" role="button" aria-expanded="false" aria-controls="step5-matrix-content">
                <h2>Step 5: Strategic Positioning Matrix</h2>
                <span class="toggle-icon" aria-hidden="true">▼</span>
            </div>
            <div class="section-content" id="step5-matrix-content">
                <div class="section-inner">

            <div class="matrix-container">
                <p style="color: #6b7280; margin-bottom: 15px;">
                    Your selected trends positioned by implementation timeline and business impact
                </p>
                <div class="matrix-grid" id="matrixGrid">
                    <div class="matrix-cell"></div>
                    <div class="matrix-cell matrix-label">
                        <strong>Near-term (0-2 years)</strong>
                    </div>
                    <div class="matrix-cell matrix-label">
                        <strong>Long-term (3-5 years)</strong>
                    </div>
                    <div class="matrix-cell matrix-label">
                        <strong style="writing-mode: vertical-rl; transform: rotate(180deg);">High Impact</strong>
                    </div>
                    <div class="matrix-cell matrix-quadrant" id="quadrant-high-near"></div>
                    <div class="matrix-cell matrix-quadrant" id="quadrant-high-long"></div>
                    <div class="matrix-cell matrix-label">
                        <strong style="writing-mode: vertical-rl; transform: rotate(180deg);">Low Impact</strong>
                    </div>
                    <div class="matrix-cell matrix-quadrant" id="quadrant-low-near"></div>
                    <div class="matrix-cell matrix-quadrant" id="quadrant-low-long"></div>
                </div>
            </div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="resetWidget()">Start Over</button>
            <button class="btn btn-primary" onclick="exportToPDF()">Export Analysis to PDF</button>
        </div>
    </div>

    <script>
        // Trend data with descriptions and strategic properties
        const trends = [
            { id: 'ai', name: 'AI & Personalization', desc: 'Machine learning for fan experience customization', timeline: 'near', impact: 'high' },
            { id: 'vr', name: 'VR/AR Experiences', desc: 'Immersive viewing and virtual venue experiences', timeline: 'long', impact: 'high' },
            { id: 'blockchain', name: 'Blockchain & NFTs', desc: 'Digital collectibles and fan tokens', timeline: 'long', impact: 'low' },
            { id: 'streaming', name: 'Streaming Dominance', desc: 'Direct streaming replacing traditional broadcast', timeline: 'near', impact: 'high' },
            { id: 'womens', name: "Women's Sports Growth", desc: 'Explosive growth in women\'s leagues and viewership', timeline: 'near', impact: 'high' },
            { id: 'emerging', name: 'Emerging Sports', desc: 'Non-traditional sports gaining mainstream traction', timeline: 'long', impact: 'low' },
            { id: 'genz', name: 'Gen Z Engagement', desc: 'Short-form content and mobile-first experiences', timeline: 'near', impact: 'high' },
            { id: 'international', name: 'International Expansion', desc: 'Global markets and cross-border fan growth', timeline: 'long', impact: 'high' },
            { id: 'betting', name: 'Betting Integration', desc: 'In-app betting and real-time wagering features', timeline: 'near', impact: 'high' },
            { id: 'directfan', name: 'Direct-to-Fan Models', desc: 'Bypassing intermediaries for direct relationships', timeline: 'near', impact: 'high' },
            { id: 'esg', name: 'ESG & Sustainability', desc: 'Environmental and social responsibility initiatives', timeline: 'long', impact: 'low' },
            { id: 'athlete', name: 'Athlete Empowerment', desc: 'Player-driven brands and direct monetization', timeline: 'near', impact: 'low' }
        ];

        // State management
        let selectedTrends = [];
        let budgetAllocations = {};
        let currentScenario = 'realistic';
        let impactChart = null;

        // Initialize
        function init() {
            renderTrendCards();
            updateSelectedCount();
        }

        function renderTrendCards() {
            const grid = document.getElementById('trendsGrid');
            grid.innerHTML = trends.map(trend => `
                <div class="trend-card" data-trend="${trend.id}" onclick="toggleTrend('${trend.id}')">
                    <div class="trend-name">${trend.name}</div>
                    <div class="trend-desc">${trend.desc}</div>
                </div>
            `).join('');
        }

        function toggleTrend(trendId) {
            const index = selectedTrends.indexOf(trendId);

            if (index > -1) {
                selectedTrends.splice(index, 1);
            } else {
                if (selectedTrends.length >= 3) {
                    return; // Can't select more than 3
                }
                selectedTrends.push(trendId);
            }

            updateTrendCards();
            updateSelectedCount();

            if (selectedTrends.length === 3) {
                showStep2();
            } else {
                hideSteps([2, 3, 4, 5]);
            }
        }

        function updateTrendCards() {
            document.querySelectorAll('.trend-card').forEach(card => {
                const trendId = card.dataset.trend;
                const isSelected = selectedTrends.includes(trendId);
                const isDisabled = !isSelected && selectedTrends.length >= 3;

                card.classList.toggle('selected', isSelected);
                card.classList.toggle('disabled', isDisabled);
            });
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = `Selected: ${selectedTrends.length} / 3`;
        }

        function showStep2() {
            document.getElementById('step2').classList.remove('hidden');
            renderBudgetSliders();
        }

        function renderBudgetSliders() {
            const container = document.getElementById('budgetSliders');
            budgetAllocations = {};

            container.innerHTML = selectedTrends.map(trendId => {
                const trend = trends.find(t => t.id === trendId);
                budgetAllocations[trendId] = 0;

                return `
                    <div class="allocation-slider">
                        <div class="slider-header">
                            <span class="trend-label">${trend.name}</span>
                            <span class="slider-value">$<span id="value-${trendId}">0</span>M</span>
                        </div>
                        <label for="slider-${trendId}" class="sr-only">${trend.name} budget allocation</label>
                        <input type="range" id="slider-${trendId}" min="0" max="50" value="0" step="1"
                               oninput="updateBudget('${trendId}', this.value)"
                               aria-label="${trend.name} budget slider">
                    </div>
                `;
            }).join('');
        }

        function updateBudget(trendId, value) {
            budgetAllocations[trendId] = parseInt(value);
            document.getElementById(`value-${trendId}`).textContent = value;

            const total = Object.values(budgetAllocations).reduce((sum, val) => sum + val, 0);
            const remaining = 50 - total;

            const remainingEl = document.getElementById('budgetRemaining');
            remainingEl.textContent = `Remaining: $${remaining}M`;
            remainingEl.className = 'budget-remaining ' + (remaining > 0 ? 'positive' : remaining === 0 ? 'zero' : 'negative');

            if (remaining === 0) {
                showStep3();
                showStep4();
                showStep5();
            } else {
                hideSteps([3, 4, 5]);
            }
        }

        function showStep3() {
            document.getElementById('step3').classList.remove('hidden');
            renderImpactChart();
            renderImpactSummary();
        }

        function showStep4() {
            document.getElementById('step4').classList.remove('hidden');
        }

        function showStep5() {
            document.getElementById('step5').classList.remove('hidden');
            renderMatrix();
        }

        function hideSteps(stepNumbers) {
            stepNumbers.forEach(num => {
                document.getElementById(`step${num}`).classList.add('hidden');
            });
        }

        function renderImpactChart() {
            const ctx = document.getElementById('impactChart').getContext('2d');

            if (impactChart) {
                impactChart.destroy();
            }

            const impactData = calculateImpact();

            impactChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Media Rights', 'Ticketing', 'Sponsorship', 'Merchandising', 'Betting'],
                    datasets: [{
                        label: 'Revenue Impact (%)',
                        data: impactData,
                        backgroundColor: ['#6b7280', '#6b7280', '#6b7280', '#6b7280', '#6b7280'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: `${currentScenario.charAt(0).toUpperCase() + currentScenario.slice(1)} Scenario - 3 Year Revenue Impact`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value >= 0 ? '+' + value + '%' : value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function calculateImpact() {
            // Impact multipliers for each trend on each revenue stream
            const impactMatrix = {
                ai: { media: 15, ticketing: 10, sponsorship: 20, merchandising: 25, betting: 30 },
                vr: { media: 25, ticketing: 5, sponsorship: 15, merchandising: 10, betting: 20 },
                blockchain: { media: 5, ticketing: 3, sponsorship: 10, merchandising: 30, betting: 15 },
                streaming: { media: 40, ticketing: -10, sponsorship: 15, merchandising: 5, betting: 25 },
                womens: { media: 35, ticketing: 30, sponsorship: 40, merchandising: 35, betting: 20 },
                emerging: { media: 20, ticketing: 25, sponsorship: 30, merchandising: 15, betting: 25 },
                genz: { media: 15, ticketing: -5, sponsorship: 25, merchandising: 20, betting: 35 },
                international: { media: 30, ticketing: 15, sponsorship: 35, merchandising: 40, betting: 25 },
                betting: { media: 10, ticketing: 5, sponsorship: 20, merchandising: 5, betting: 100 },
                directfan: { media: -20, ticketing: 40, sponsorship: 15, merchandising: 35, betting: 10 },
                esg: { media: 5, ticketing: 3, sponsorship: 25, merchandising: 10, betting: -10 },
                athlete: { media: 10, ticketing: 5, sponsorship: 30, merchandising: 40, betting: 15 }
            };

            const scenarioMultipliers = {
                optimistic: 1.5,
                realistic: 1.0,
                pessimistic: 0.5
            };

            const multiplier = scenarioMultipliers[currentScenario];
            const streams = ['media', 'ticketing', 'sponsorship', 'merchandising', 'betting'];

            return streams.map(stream => {
                let impact = 0;
                selectedTrends.forEach(trendId => {
                    const budgetWeight = budgetAllocations[trendId] / 50;
                    impact += impactMatrix[trendId][stream] * budgetWeight * multiplier;
                });
                return Math.round(impact);
            });
        }

        function renderImpactSummary() {
            const impacts = calculateImpact();
            const streams = ['Media Rights', 'Ticketing', 'Sponsorship', 'Merchandising', 'Betting'];

            const html = streams.map((stream, i) => {
                const value = impacts[i];
                const className = value > 10 ? 'impact-positive' : value < -5 ? 'impact-negative' : 'impact-neutral';
                const sign = value >= 0 ? '+' : '';

                return `
                    <div class="impact-row">
                        <span class="impact-label">${stream}</span>
                        <span class="impact-value ${className}">${sign}${value}%</span>
                    </div>
                `;
            }).join('');

            document.getElementById('impactSummary').innerHTML = html;
        }

        function switchScenario(scenario) {
            currentScenario = scenario;

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });

            renderImpactChart();
            renderImpactSummary();
        }

        function renderMatrix() {
            const matrix = {
                'high-near': [],
                'high-long': [],
                'low-near': [],
                'low-long': []
            };

            selectedTrends.forEach(trendId => {
                const trend = trends.find(t => t.id === trendId);
                const key = `${trend.impact}-${trend.timeline}`;
                matrix[key].push(trend.name);
            });

            Object.keys(matrix).forEach(quadrant => {
                const el = document.getElementById(`quadrant-${quadrant}`);
                el.innerHTML = matrix[quadrant].map(name =>
                    `<div class="matrix-trend-item">${name}</div>`
                ).join('');
            });
        }

        function resetWidget() {
            selectedTrends = [];
            budgetAllocations = {};
            currentScenario = 'realistic';

            if (impactChart) {
                impactChart.destroy();
                impactChart = null;
            }

            renderTrendCards();
            updateSelectedCount();
            hideSteps([2, 3, 4, 5]);

            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === 'realistic');
            });
        }

        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            // Title
            pdf.setFontSize(20);
            pdf.setFont(undefined, 'bold');
            pdf.text('Future Trends Strategic Analysis', 20, 20);

            // Selected Trends
            pdf.setFontSize(14);
            pdf.text('Selected Trends & Budget Allocation', 20, 35);
            pdf.setFontSize(11);
            pdf.setFont(undefined, 'normal');

            let yPos = 45;
            selectedTrends.forEach(trendId => {
                const trend = trends.find(t => t.id === trendId);
                const allocation = budgetAllocations[trendId];
                pdf.text(`• ${trend.name}: $${allocation}M (${Math.round(allocation/50*100)}%)`, 25, yPos);
                yPos += 7;
            });

            // Impact Analysis
            yPos += 10;
            pdf.setFontSize(14);
            pdf.setFont(undefined, 'bold');
            pdf.text('Revenue Stream Impact (Realistic Scenario)', 20, yPos);

            yPos += 10;
            pdf.setFontSize(11);
            pdf.setFont(undefined, 'normal');
            const impacts = calculateImpact();
            const streams = ['Media Rights', 'Ticketing', 'Sponsorship', 'Merchandising', 'Betting'];

            streams.forEach((stream, i) => {
                const value = impacts[i];
                const sign = value >= 0 ? '+' : '';
                pdf.text(`${stream}: ${sign}${value}%`, 25, yPos);
                yPos += 7;
            });

            // Strategic Positioning
            yPos += 10;
            pdf.setFontSize(14);
            pdf.setFont(undefined, 'bold');
            pdf.text('Strategic Positioning', 20, yPos);

            yPos += 10;
            pdf.setFontSize(11);
            pdf.setFont(undefined, 'normal');

            selectedTrends.forEach(trendId => {
                const trend = trends.find(t => t.id === trendId);
                const timeline = trend.timeline === 'near' ? '0-2 years' : '3-5 years';
                const impact = trend.impact === 'high' ? 'High Impact' : 'Low Impact';
                pdf.text(`• ${trend.name}: ${timeline}, ${impact}`, 25, yPos);
                yPos += 7;
            });

            // Footer
            pdf.setFontSize(9);
            pdf.setTextColor(128);
            pdf.text('Generated by Future Trends Predictor Widget', 20, 280);
            pdf.text(new Date().toLocaleDateString(), 170, 280);

            pdf.save('future-trends-analysis.pdf');
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const header = content.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');
            const isExpanded = content.classList.contains('expanded');

            content.classList.toggle('expanded');
            icon.classList.toggle('expanded');
            header.setAttribute('aria-expanded', !isExpanded);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
